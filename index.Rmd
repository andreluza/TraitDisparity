---
title: "Supplementary material, Geographical imprints of trait evolution in evolutionary radiations"
author: "Andr√© Luza"
date: "31/08/2021"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Appendix S2: Results considering the set of 100 fully resolved phylogenies, but considering the 216 species that had occurrence, traits and phylogenetic data, and the species belonging to the clade Oryzomyialia.

This is a document that reports alternative results of our paper. Here we show figures similar to the ones showed in the main text. The first one is the relationship between SES MPD (mean pairwise (phylogenetic) distance between species) and SES disparity regarding the empirical skull dataset, and three datasets generated by trait simulation (Brownian motion, Early-Burst, and OU). The second one is a panel with maps of empirical and SES disparity found for each evolutionary model, as well correlation between these estimates.


#### 216 species
The first thing we did was to show the bivariate plot describind the relationship between SES disparity and SES MPD, for empirical and simulated datasets, also was similar to the one reported in the main results (Fig. 2 in the main text). Overall, the disparity produced by the EB model had a closer relationship with the empirical disparity than other models of evolution (OU and BM). However, phylogenetic uncertainty (as shown by the boxplots) was much higher here --mainly for EB -- than when using the phylogeny with 413 species to simulate the trait.


```{r, echo = F, fig.height=6.5,fig.width=6.5,fig.margin=F, message=F, warning=F}

source ("./R/Interpretation_Fig2_and_statistics_216spp.R")

# run this to get the panel with the relationship between MPD and DISPARITY
# and other results

```




Then we counted the number of cells in the map with values of disparity higher, equal, or lower than the null model (including randomization, NULL) and evolutionary models (OU, BM, EB). As can be seen, the number of cells with values of disparity higher, equal, or lower than the null model and evolutionary models was pretty similar to the number reported in the main results.




```{r pressure, echo=FALSE}

# the number of cells with  empirical disparity either higher or lower than
# the null/evol model disparity
# (significance in terms of to have values more extreme than 1.96)

count_cells_relative_to_models


```
When mapping the values of empirical and simulated trait values, we found a high agreement between the following maps and the ones showed in Fig. 3 of main text. The null disparity, as produced by a null model of random shuffling of species labels (rows) in the trait table, produces underestimated values of disparity (as shown in B, blue color). In contrast, the estimates of a BM model produced [smoother] estimates (C).



```{r, echo = F, fig.height=7,fig.width=7,fig.margin=F, message=F, warning=F}

source ("./R/Interpretation_Fig3_216spp.R")

# run this to get the panel with the relationship between MPD and DISPARITY
# and other results

```



We also show that using a null model is quite similar than simulation a trait using the OU model. This can be seen in the following map, where the null disparity and the disparity produced by the OU model produced quite similar maps, and estimates were highly correlated (0.98, Table below the map). The correlation also was high between the Null and BM disparity.





```{r, echo = F, fig.height=7,fig.width=7,fig.margin=F, message=F, warning=F}


alternative_map1


```


Table of correlation between these estimates


```{r , echo=FALSE}

## show the correlation between average null and simulated by OU

cor (data.frame (RAO_OBS$med_nulo, obsBM,obsEB,obsOU))


```


Finally the map of significance of SES disparity to show which places have a disparity that deviates -1.96 or +1.96 standard deviations from zero.
What we see in this map is that: 1) the null model often underestimate disparity, now shown by the significance of the SES disparity, resulting in SES disparity lower than the null expectation at most of the Neotropics; 2) Atlantic Rainforest has communities with much higher disparity than expected by the evolutionary models.


```{r, echo = F, fig.height=7,fig.width=15,fig.margin=F, message=F, warning=F}


panel3
 

```



#### Oryzomyialia

Bivariate plot similar to Fig. 2. This is pretty similar to the results in the main text and alternative results considering 216 species (just presented). However, the main difference is that we lost values of SES MPD higher than zero, as now we're working only with closely related species.



```{r, echo = F, fig.height=6.5,fig.width=6.5,fig.margin=F, message=F, warning=F}

source ("./R/Interpretation_Fig2_and_statistics_oryzomyialia.R")

# run this to get the panel with the relationship between MPD and DISPARITY
# and other results

```

Counting the number of cells. This is quite similar to the number reported in the main text and results considering 216 species. The main difference is that now we have some communities with disparity HIGHER than the null disparity and BM-resulting disparity.



```{r , echo=FALSE}

# the number of cells with  empirical disparity either higher or lower than
# the null/evol model disparity
# (significance in terms of to have values more extreme than 1.96)

count_cells_relative_to_models


```



Map similar to Fig. 3, and map just reported considering 216 species.



```{r, echo = F, fig.height=7,fig.width=7,fig.margin=F, message=F, warning=F}

source ("./R/Interpretation_Fig3_oryzomyialia.R")

# run this to get the panel with the relationship between MPD and DISPARITY
# and other results

```


Map similar to Fig. 4,



```{r, echo = F, fig.height=7,fig.width=7,fig.margin=F, message=F, warning=F}


alternative_map1


```


as well correlations.



```{r , echo=FALSE}

## show the correlation between average null and simulated by OU

cor (data.frame (RAO_OBS$med_nulo, obsBM,obsEB,obsOU))


```


At the end we show the map of significance of SES disparity for each model. Now we don't have SES disparity higher than the expectations for the many models along the Atlantic Rainforest. 



```{r, echo = F, fig.height=7,fig.width=15,fig.margin=F, message=F, warning=F}


panel3
 

```




### Appendix S3: Results considering the consensus phylogeny. As it has 285 tips, the number of species used in trait simulation was 285, 169 (all species with occurrence, trait and phylogenetic data) and 159 species (belonging to the clade Oryzomyialia).


The figures have the same settings and order as the ones just presented. Let's see ...


Bivariate plot similar to Fig. 2. The EB-resulting disparity is still closer to the empirical disparity than other models.


```{r, echo = F, fig.height=6.5,fig.width=6.5,fig.margin=F, message=F, warning=F}

source ("./R_concensus_supp_S2/Interpretation_Fig2_and_statistics_413spp.R")

# run this to get the panel with the relationship between MPD and DISPARITY

figure1
# and other results

```

Counting the number of cells. This is quite similar to the number reported in the main text and results considering 216 species. The main difference is that now we have some communities with disparity HIGHER than the null disparity and BM-resulting disparity.



```{r , echo=FALSE}

# the number of cells with  empirical disparity either higher or lower than
# the null/evol model disparity
# (significance in terms of to have values more extreme than 1.96)

count_cells_relative_to_models


```



Map similar to Fig. 3, and map just reported considering 216 species. The main difference is that the values of SES disparity are ~0.3 units higher (for positive and negative sides) than the previous results we reported.



```{r, echo = F, fig.height=7,fig.width=7,fig.margin=F, message=F, warning=F}

source ("./R_concensus_supp_S2/Interpretation_Fig3_413spp.R")

# run this to get the panel with the relationship between MPD and DISPARITY
# and other results

```


Map similar to Fig. 4, but that now show little correlation between null and evolution-based disparity.



```{r, echo = F, fig.height=7,fig.width=7,fig.margin=F, message=F, warning=F}


alternative_map1


```


and correlations are much lower than the ones reported in the previous results and main text.



```{r , echo=FALSE}

## show the correlation between average null and simulated by OU

cor (data.frame (RAO_OBS$med_nulo, obsBM,obsEB,obsOU))


```


At the end we show the map of significance of SES disparity for each model. Now we don't have SES disparity higher or lower than expected by EB and BM. Again the null model and OU seems to underestimated disparity.



```{r, echo = F, fig.height=7,fig.width=15,fig.margin=F, message=F, warning=F}


panel3
 

```


These results mostly repeat considering 169 species with occurrence, trait and phylogenetic data:


```{r, echo = F, fig.height=6.5,fig.width=6.5,fig.margin=F, message=F, warning=F}

source ("./R_concensus_supp_S2/Interpretation_Fig2_and_statistics_216spp.R")

# run this to get the panel with the relationship between MPD and DISPARITY

figure1
# and other results

```

Counting the number of cells. 



```{r , echo=FALSE}

# the number of cells with  empirical disparity either higher or lower than
# the null/evol model disparity
# (significance in terms of to have values more extreme than 1.96)

count_cells_relative_to_models


```



Map similar to Fig. 3.



```{r, echo = F, fig.height=7,fig.width=7,fig.margin=F, message=F, warning=F}

source ("./R_concensus_supp_S2/Interpretation_Fig3_216spp.R")

# run this to get the panel with the relationship between MPD and DISPARITY
# and other results

```


Map similar to Fig. 4.



```{r, echo = F, fig.height=7,fig.width=7,fig.margin=F, message=F, warning=F}


alternative_map1


```


and correlations.



```{r , echo=FALSE}

## show the correlation between average null and simulated by OU

cor (data.frame (RAO_OBS$med_nulo, obsBM,obsEB,obsOU))


```


At the end we show the map of significance of SES disparity for each model.



```{r, echo = F, fig.height=7,fig.width=15,fig.margin=F, message=F, warning=F}


panel3
 

```

And similar to Oryzomyialia as well.



```{r, echo = F, fig.height=6.5,fig.width=6.5,fig.margin=F, message=F, warning=F}

source ("./R_concensus_supp_S2/Interpretation_Fig2_and_statistics_oryzomyialia.R")

# run this to get the panel with the relationship between MPD and DISPARITY

figure1
# and other results

```

Counting the number of cells. 



```{r , echo=FALSE}

# the number of cells with  empirical disparity either higher or lower than
# the null/evol model disparity
# (significance in terms of to have values more extreme than 1.96)

count_cells_relative_to_models


```



Map similar to Fig. 3.



```{r, echo = F, fig.height=7,fig.width=7,fig.margin=F, message=F, warning=F}

source ("./R_concensus_supp_S2/Interpretation_Fig3_oryzomyialia.R")
panel2
# run this to get the panel with the relationship between MPD and DISPARITY
# and other results

```


Map similar to Fig. 4.



```{r, echo = F, fig.height=7,fig.width=7,fig.margin=F, message=F, warning=F}


alternative_map1


```


and correlations.



```{r , echo=FALSE}

## show the correlation between average null and simulated by OU

cor (data.frame (RAO_OBS$med_nulo, obsBM,obsEB,obsOU))


```


At the end we show the map of significance of SES disparity for each model.
This results supports the one reported in the main text (divergent evolution in the Atlantic Rainforest)



```{r, echo = F, fig.height=7,fig.width=15,fig.margin=F, message=F, warning=F}


panel3
 

```


### Appendix S4: Sensitivity of results to model parameters


Finally, we report results regarding different values of model parameters.


To understand whether results were sensitive to model parameter values (basically sigma for BM, sigma and beta for EB, and sigma and alpha for OU), we ran sensitivity analyses in terms of how the regression coefficient of SES disparity relative to SES MPD (SES disparity ~ SES MPD) would change with data simulated using different model parameters. 
We then simulated trait data using the following values:
  *sigma: 0.5, 1.0, 1.5, 2.0 (weak to strong rate of random fluctuations)
  beta: -0.5,  0.0,  0.5,  1.0 (early to late burst)
  alpha: 1.0 1.5 2.0 2.5 (weak to strong attraction to an average trait value)*

Results presented in the main text show the similarity of the SES disparity ~SES MPD relationship regarding the empirical and simulated disparity (BM-, EB- and OU-simulated disparity) (Fig. 2 in the main). Here, we did the same analysis but now considering this range of values of sigma, beta, and alpha. Remember that in the main text we used: sigma = 1, beta = -0.5, and alpha = 1. Here we used the consensus phylogeny to save processing time.

We found that the shape of the empirical SES disparity ~SES MPD relationship was quite similar to simulated SES disparity ~ SES MPD across the alternative values of sigma (Fig. S3.1). The slopes of simulated SES disparity ~ SES MPD were 
less steeper than the slope produced by empirical SES disparity ~ SES MPD, as reported in the main results.

We found that the shape of the empirical SES disparity ~SES MPD relationship was quite similar to the simulated SES disparity ~ SES MPD across the alternative values of beta (Fig. S3.2) -- except to a late-burst model with beta = 1. SES disparity calculated using traits simulated with values of beta = -0.5 and 0 produced a slope relative to SES MPD very closer to the slope found for the empirical SES disparity.

Different values of alpha produced very different simulated SES disparity relative to SES MPD -- since positive to neutral and negative slopes (Fig. S3.3). Disregarding the alpha value, all relationships produced slopes that were quite different relative to the slope of empirical SES disparity ~ SES MPD reported in the main text.
Finally, neither BM nor OU (and alternative values of sigma and alpha) produced a simulated SES disparity ~ SES MPD as closer to the empirical SES disparity ~ SES MPD as the EB model (as found in the main results). 



```{r, echo = F, fig.height=6.5,fig.width=6.5,fig.margin=F, message=F, warning=F}

source ("./R_sensitivity_supp_S3/Interpretation_Fig2_and_statistics_413spp.R")

# run this to get the panel with the relationship between MPD and DISPARITY

panel
# and other results

```

Scatter plot showing the relationship between SES disparity and SES MPD across different values of alpha (the parameter of OU evolution model). The OU model also has a sigma parameter, and it was set to 1.
